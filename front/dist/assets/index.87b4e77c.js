var H=Object.defineProperty,N=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var S=(e,t,s)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t||(t={}))F.call(t,s)&&S(e,s,t[s]);if(T)for(var s of T(t))j.call(t,s)&&S(e,s,t[s]);return e},b=(e,t)=>N(e,x(t));import{H as G,a as u,j as $,c as K,b as W,d as Y,m as q,r as E,o as k,e as L,f as c,g as p,w as R,t as y,h as I,u as z,F as J,i as Z,s as Q,P as X,l as ee,k as te}from"./vendor.b252ceff.js";const se=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};se();const re="modulepreload",P={},ne="/",f=function(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${ne}${r}`,r in P)return;P[r]=!0;const n=r.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":re,n||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),n)return new Promise((g,V)=>{a.addEventListener("load",g),a.addEventListener("error",V)})})).then(()=>t())},A={VITE_APP_URL:"https://live.thehmm.karls.computer",VITE_APP_SOCKET_URL:"https://api.live.thehmm.karls.computer",VITE_APP_API_URL:"https://api.live.thehmm.karls.computer/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},oe=A.VITE_APP_URL,ae=A.VITE_APP_API_URL,ie=A.VITE_APP_SOCKET_URL,ce={html:!0,linkify:!0,typographer:!0,emoji:!0,breaks:!0};var v={URL:oe,apiURL:ae,socketURL:ie,md:ce};const le=(e,...t)=>{for(const s of t)typeof s=="object"?(console.log(`- ${e.toUpperCase()}:`),console.log(s)):console.log(`- ${e.toUpperCase()}: ${s}`)},U=(e,...t)=>{for(const s of t)typeof s=="object"?(console.info(`* ${e.toUpperCase()}:`),console.info(s)):console.info(`* ${e.toUpperCase()}: ${s}`)},ue=(e,...t)=>{for(const s of t)console.warn(`! ${e.toUpperCase()}: ${s}`)},de=(e,...t)=>{for(const s of t)console.error(`x ${e.toUpperCase()}: ${s}`)},_e=(e,...t)=>{for(const s of t)U(`x ${e.toUpperCase()}:`),console.table(`x ${e.toUpperCase()}: ${s}`)},me=e=>{console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info("* * * * * * * * * * * The Hmm * * * * * * * * * * * *"),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log(),console.info(`* STATIC URL => ${e.URL}`),console.info(`* STRAPI URL => ${e.apiURL}`),console.info(`* SOCKET URL => ${e.socketURL}`),console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log()};var i={log:le,info:U,warn:ue,error:de,table:_e,intro:me};const O=v.apiURL,fe=(e,t=3)=>{if(e===0)return"0 Bytes";const s=1024,r=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(r))+" "+n[o]},he=e=>$(e)+84,pe=e=>{const s=e.data,r=e.headers,n=+r["content-length"]||s.length,o=$(r)-54;return n+o},ve=e=>{const t=e.url;return d.dispatch("network/add_bytes_sent",{url:t,to:t.includes(O)?"api":"assets",bytes:he(e)}),e},ge=e=>{const t=e.request.responseURL;return d.dispatch("network/add_bytes_received",{url:t,from:t.includes(O)?"api":"assets",bytes:pe(e)}),e};new G(u).register({onRequest:e=>ve(e),onResponse:e=>ge(e)});const h=async e=>{d.getters["network/is_registered_asset"](e)&&i.warn("NETWORK",`HEAD-ing registered url ${e}`);try{await m.assets.head(e)}catch(t){i.error("NETWORK",t)}},be=async()=>{h("index.html");const e=document.querySelectorAll("script"),t=document.querySelectorAll("link");for(const s of e)s.src&&!s.src.includes("@")&&h(s.src);for(const s of t)s.href&&h(s.href)};new MutationObserver(e=>{for(const t of e)for(const s of t.addedNodes)(s.href||s.src)&&h(s.href||s.src)}).observe(document.head,{childList:!0});var D={format_bytes:fe,head_assets:be};function ye(){var e,t;return(t=(e=this.$options)==null?void 0:e.name)==null?void 0:t.toLowerCase()}const _=v.apiURL,Ee={get:()=>new Promise(async e=>u.get(`${_}/meta`).then(t=>e(t.data.data.attributes)).catch(t=>i.error("API",t)))},Ae={get:()=>(i.info("API","Fetching livestream."),new Promise(e=>u.get(`${_}/livestream`).then(t=>e(t.data.data.attributes.publicData)).catch(t=>i.error("API",t))))},Te={count:()=>(i.info("API","Counting events."),new Promise(e=>{u.get(`${_}/events/count`).then(t=>e(t.data)).catch(t=>i.error("API",t))})),getAll:()=>(i.info("API","Fetching events."),new Promise(e=>{u.get(`${_}/events`,{params:{sort:"starts:desc",fields:["title","slug","starts","ends","info","recordingURL"],populate:["logo"]}}).then(t=>{const s=t.data.data;for(let r=0;r<s.length;r++)s[r]=l(l({},s[r]),s[r].attributes),delete s[r].attributes;e(s)}).catch(t=>i.error("API",t))})),get:e=>(i.info("API",`Fetching event ${e}.`),new Promise(t=>{u.get(`${_}/events/${e}`,{params:{fields:"*",populate:["logo","viewers","messages","announcements","emoji_groups"]}}).then(s=>{const r=s.data.data,n=l(l({},r),r.attributes);delete n.attributes,t(n)}).catch(s=>i.error("API",s))}))},Se={get:e=>new Promise(t=>u.get(`${_}/viewers`,{params:{uuid:e}}).then(s=>t(s.data)).catch(s=>i.error("API",s)))},Re={head:e=>(i.info("API",`Heading asset ${e}.`),new Promise(t=>u.head(e).then(s=>t(s)).catch(s=>i.error("API",s))))};var m={meta:Ee,livestream:Ae,events:Te,viewers:Se,assets:Re},Pe={namespaced:!0,state:{livestream:null},mutations:{SET_LIVESTREAM:(e,t)=>e.livestream=t},getters:{get_livestream:e=>e.livestream},actions:{fetch_livestream({commit:e}){return new Promise((t,s)=>m.livestream.get().then(r=>{e("SET_LIVESTREAM",r),t(r)}).catch(r=>s(r)))},async get_livestream({getters:e,dispatch:t}){return e.get_livestream||await t("fetch_livestream")},socket_streamUpdate({commit:e},t){e("SET_LIVESTREAM",t),logger.info("SOCK",`got livestream update: ${t.status}`)}}},we={namespaced:!0,state:{events:[]},mutations:{SET_EVENT:(e,t)=>{const s=e.events.find(r=>r.slug==t.slug);if(s)e.events[e.events.indexOf(s)]=l(l({},s),t);else{const r=e.events.findIndex(n=>n.starts<t.starts);r==-1?e.events.push(t):e.events.splice(r,0,t)}}},getters:{get_events:e=>e.events,get_event:e=>t=>e.events.find(s=>s.slug===t),get_event_slugs:e=>e.events.map(t=>t.slug)},actions:{fetch_events_count(){return new Promise((e,t)=>m.events.count().then(s=>e(s)).catch(s=>t(s)))},fetch_events({commit:e}){return new Promise((t,s)=>m.events.getAll().then(r=>{for(const n of r)e("SET_EVENT",n);t(r)}).catch(r=>s(r)))},fetch_event({commit:e},t){return new Promise((s,r)=>m.events.get(t).then(n=>{e("SET_EVENT",n),s(n)}).catch(n=>r(n)))},async get_events({getters:e,dispatch:t}){const s=e.get_events.length;let r;try{r=await t("fetch_events_count")}catch{r=s}return r>s?await t("fetch_events"):e.get_events},async get_event({getters:e,dispatch:t},s){const r=e.get_event(s);return r&&r.viewers?r:await t("fetch_event",s)}}},$e={namespaced:!0,state:{transfers:{assets:{bytes_sent:0,bytes_received:0,registered:[]},api:{bytes_sent:0,bytes_received:0},socket:{bytes_sent:0,bytes_received:0},mux:{bytes_sent:0,bytes_received:0}}},mutations:{ADD_BYTES_SENT:(e,{to:t,bytes:s})=>{e.transfers[t].bytes_sent+=s},ADD_BYTES_RECEIVED:(e,{from:t,bytes:s})=>{e.transfers[t].bytes_received+=s},REGISTER_ASSET:(e,t)=>{e.transfers.assets.registered.push(t)}},getters:{total_bytes_sent:e=>Object.values(e.transfers).map(t=>t.bytes_sent).reduce((t,s)=>t+s),total_bytes_received:e=>Object.values(e.transfers).map(t=>t.bytes_received).reduce((t,s)=>t+s),total_bytes_transferred:(e,t)=>t.total_bytes_sent+t.total_bytes_received,is_registered_asset:e=>t=>e.transfers.assets.registered.find(s=>s.includes(t))},actions:{add_bytes_sent({commit:e},{url:t,to:s,bytes:r}){e("ADD_BYTES_SENT",{to:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),i.info("STORE",`Sent ${r} bytes to ${s}.`)},add_bytes_received({commit:e},{url:t,from:s,bytes:r}){e("ADD_BYTES_RECEIVED",{from:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),i.info("STORE",`Received ${r} bytes from ${s}.`)}}};const w=()=>({meta:null,isMobile:!1,colorPalette:["background","background2","body","highlight","controls","chat"],activeClasses:["active"],users:{},chat:{},announcements:{},uid:localStorage.uid?localStorage.uid:null,blocked:!1,count:0,isAdmin:localStorage.admin?JSON.parse(localStorage.admin):!1});var d=K({strict:!1,state:w(),modules:{livestream:Pe,events:we,network:$e},mutations:{SET_META:(e,t)=>e.meta=t,SET_MOBILE:(e,t)=>e.isMobile=t,setUsers:(e,t)=>e.users=t,setUser:(e,t)=>e.users[t.uid]=t,setChat:(e,t)=>e.chat=t,setMessage:(e,t)=>e.chat[t.time]=t,setAnnouncements:(e,t)=>e.announcements=t,setAnnouncement:(e,t)=>e.announcements[t.time]=t,setUid:(e,t)=>e.uid=t,setBlock:(e,t)=>e.blocked=t,setCount:(e,t)=>e.count=t,setMobile:(e,t)=>e.isMobile=t,adminify:e=>e.isAdmin=!0,RESET:e=>{const t=w();Object.keys(t).forEach(s=>e[s]=t[s])}},getters:{meta:e=>e.meta,isActive:e=>t=>[...e.activeClasses,e.metainfo.buttonWhenStreamIsActive,e.metainfo.buttonWhenStreamIsRewatchable].includes(t),chatArray:e=>Object.values(e.chat),chatByTime:(e,t)=>{let s=[];return e.isMobile?s=[...t.chatArray,...t.publishedAnns].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>{const o=r.publishedAt||r.time,a=n.publishedAt||n.time;return o-a}):s=[...t.chatArray].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>r.time-n.time),s},publishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt>0).sort((s,r)=>s.publishedAt-r.publishedAt),unpublishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt==0).sort((s,r)=>s.time-r.time),announcementsArray:e=>Object.values(e.announcements).filter(t=>t.deleted===!1)},actions:{fetchMeta({commit:e}){return new Promise((t,s)=>m.meta.get().then(r=>{e("SET_META",r),t(r)}).catch(r=>s(r)))},async getMeta({getters:e,dispatch:t}){return e.meta||await t("fetchMeta")},reset({commit:e}){e("RESET")},registerBroadcasts({state:e,commit:t},s){t("setBroadcasts",s.map(r=>b(l({},r),{theme:e.colorPalette.map(n=>({[`--${n}`]:r[n]})),isInPast:new Date>new Date(r.FilmEndsOn),isInFuture:new Date<new Date(r.LiveStartsOn)})))},socket_user({state:e,commit:t},s){t("setUser",s),e.uid&&s.uid===e.uid&&!e.isAdmin&&(s.blocked?(logger.warn("STORE","blocked"),t("setBlock",!0)):(logger.warn("STORE","unblocked"),t("setBlock",!1)))},socket_userConfirm({commit:e},t){logger.info("STORE","Your User ID:",t),e("setUid",t),localStorage.uid=t},socket_count({commit:e},t){e("setCount",t)},socket_clearchat({commit:e}){e("setChat",{})},socket_clearusers({commit:e}){e("setUsers",{}),localStorage.clear(),window.location.reload(!0)},register({state:e},t){this._vm.$socket.client.emit("user",{name:t,blocked:!1})},deleteMessage(e,t){this._vm.$socket.client.emit("message",b(l({},t),{deleted:!0}))},adminify({commit:e},t){t==="yellow"&&(e("adminify"),localStorage.administrator=!0)}}});const M=W({history:Y("/"),routes:[{path:"/",name:"home",component:()=>f(()=>import("./Home.2436c52a.js"),["assets/Home.2436c52a.js","assets/vendor.b252ceff.js"]),beforeEnter:async()=>await Le()},{path:"/about",name:"about",component:()=>f(()=>import("./About.c16524e7.js"),["assets/About.c16524e7.js","assets/vendor.b252ceff.js"])},{path:"/404",name:"Page Not Found",component:()=>f(()=>import("./404.d0598ac7.js"),["assets/404.d0598ac7.js","assets/vendor.b252ceff.js"])},{path:"/:slug",name:"event",component:()=>f(()=>import("./Event.1fe91b47.js"),["assets/Event.1fe91b47.js","assets/vendor.b252ceff.js"]),beforeEnter:async e=>await Ie(e.params.slug)},{path:"/:pathMatch(.*)*",redirect:{name:"Page Not Found"}}]}),ke=async e=>{try{await d.dispatch("livestream/get_livestream")}catch{return"404"}},Le=async()=>{try{await d.dispatch("events/get_events")}catch{return"404"}},Ie=async e=>{try{await d.dispatch("events/get_event",e)}catch(t){return i.error("ROUTER",`Event page ${e} not found.`,t),"404"}};M.beforeEach(async e=>await ke());var C=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s};const Ue={name:"Header",computed:l({},q("network",["total_bytes_sent","total_bytes_received","total_bytes_transferred"])),methods:{format_bytes:D.format_bytes}},Oe=c("h1",null,"The Hmm Livestream",-1),De=I("Home"),Me=I("About"),Ce=c("br",null,null,-1),Be={id:"network"},Ve=c("td",null,"total bytes sent",-1),He=c("td",null,"total bytes received",-1),Ne=c("td",null,"total bytes transferred",-1);function xe(e,t,s,r,n,o){const a=E("RouterLink");return k(),L("header",null,[Oe,c("nav",null,[p(a,{to:"/"},{default:R(()=>[De]),_:1}),p(a,{to:"/about"},{default:R(()=>[Me]),_:1})]),Ce,c("table",Be,[c("tr",null,[Ve,c("td",null,y(o.format_bytes(e.total_bytes_sent)),1)]),c("tr",null,[He,c("td",null,y(o.format_bytes(e.total_bytes_received)),1)]),c("tr",null,[Ne,c("td",null,y(o.format_bytes(e.total_bytes_transferred)),1)])])])}var Fe=C(Ue,[["render",xe]]);const je={setup(){z({base:{href:"/vue-router",target:"_blank"},charset:"utf8",title:"My Title"})},name:"App",components:{Header:Fe},data(){return{observer:null}},computed:{},methods:{},created(){D.head_assets()},mounted(){}};function Ge(e,t,s,r,n,o){const a=E("Header"),g=E("RouterView");return k(),L(J,null,[p(a),p(g)],64)}var Ke=C(je,[["render",Ge]]);i.intro(v);const B=Z(Ke);Q.polyfill();B.config.globalProperties={logger:i,$id:ye};B.use(X,ee(v.socketURL),{store:d}).use(d).use(M).use(te()).mount("#app");export{C as _};
