var M=Object.defineProperty,C=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var w=(e,t,s)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t)=>{for(var s in t||(t={}))V.call(t,s)&&w(e,s,t[s]);if(A)for(var s of A(t))N.call(t,s)&&w(e,s,t[s]);return e},p=(e,t)=>C(e,B(t));import{j as T,a as y,H as $,c as F,b as x,d as H,u as j,R as G,e as K,m as Y,r as S,o as q,f as z,g as i,h as v,w as P,t as g,F as W,i as L,k as J,s as Z,P as Q,l as X,n as ee}from"./vendor.4944b02c.js";const te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};te();const se="modulepreload",R={},re="/",h=function(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${re}${r}`,r in R)return;R[r]=!0;const n=r.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":se,n||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),n)return new Promise((f,I)=>{a.addEventListener("load",f),a.addEventListener("error",I)})})).then(()=>t())},b={VITE_APP_URL:"https://live.thehmm.karls.computer",VITE_APP_SOCKET_URL:"https://api.live.thehmm.karls.computer",VITE_APP_API_URL:"https://api.live.thehmm.karls.computer/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},ne=b.VITE_APP_URL,oe=b.VITE_APP_API_URL,ae=b.VITE_APP_SOCKET_URL,ie={html:!0,linkify:!0,typographer:!0,emoji:!0,breaks:!0};var E={URL:ne,apiURL:oe,socketURL:ae,md:ie};const ce=(e,...t)=>{for(const s of t)typeof s=="object"?(console.log(`- ${e.toUpperCase()}:`),console.log(s)):console.log(`- ${e.toUpperCase()}: ${s}`)},U=(e,...t)=>{for(const s of t)typeof s=="object"?(console.info(`* ${e.toUpperCase()}:`),console.info(s)):console.info(`* ${e.toUpperCase()}: ${s}`)},le=(e,...t)=>{for(const s of t)console.warn(`! ${e.toUpperCase()}: ${s}`)},ue=(e,...t)=>{for(const s of t)console.error(`x ${e.toUpperCase()}: ${s}`)},de=(e,...t)=>{for(const s of t)U(`x ${e.toUpperCase()}:`),console.table(`x ${e.toUpperCase()}: ${s}`)},_e=e=>{console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info("* * * * * * * * * * * The Hmm * * * * * * * * * * * *"),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info(`* API => ${e.apiURL} *`),console.info(`* SOCKETS => ${e.socketURL} *`),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log()};var c={log:ce,info:U,warn:le,error:ue,table:de,intro:_e};const me=(e,t=3)=>{if(e===0)return"0 Bytes";const s=1024,r=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(r))+" "+n[o]},he={},fe={get_bytes_sent(e){return T(e)+84},get_bytes_received(e){const s=e.data,r=e.headers,n=+r["content-length"]||s.length,o=T(r)-54;return n+o}},pe={},ve={};var m={format_bytes:me,assets:he,api:fe,socket:pe,mux:ve};function ge(){var e,t;return(t=(e=this.$options)==null?void 0:e.name)==null?void 0:t.toLowerCase()}const d=y.create({baseURL:E.apiURL}),ye={get:()=>new Promise(async(e,t)=>d.get("meta").then(s=>e(s.data.data.attributes)).catch(s=>t(s)))},be={get:()=>(c.info("API","Fetching livestream."),new Promise((e,t)=>d.get("livestream").then(s=>e(s.data.data.attributes.publicData)).catch(s=>t(s))))},Ee={count:()=>(c.info("API","Counting events."),new Promise((e,t)=>{d.get("events/count").then(s=>e(s.data)).catch(s=>t(s))})),getAll:()=>(c.info("API","Fetching events."),new Promise((e,t)=>{d.get("events").then(s=>{const r=s.data.data;for(let n=0;n<r.length;n++)r[n]=u(u({},r[n]),r[n].attributes),delete r[n].attributes;e(r)}).catch(s=>t(s))})),get:e=>(c.info("API",`Fetching event ${e}.`),new Promise((t,s)=>{d.get(`events/${e}`).then(r=>{const n=r.data.data,o=u(u({},n),n.attributes);delete o.attributes,t(o)}).catch(r=>s(r))}))},Ae={get:e=>new Promise((t,s)=>d.get("viewers",{params:{uuid:e}}).then(r=>t(r.data)).catch(r=>s(r)))},we=new $(d);we.register({onRequest(e){return l.dispatch("network/add_bytes_sent",{to:"api",bytes:m.api.get_bytes_sent(e)}),e},onResponse(e){return l.dispatch("network/add_bytes_received",{from:"api",bytes:m.api.get_bytes_received(e)}),e}});const Te={head(e){return new Promise((t,s)=>y.head(e).then(r=>t(r)).catch(r=>s(r)))}},Se=new $(y);Se.register({onRequest(e){return l.dispatch("network/add_bytes_sent",{to:"assets",bytes:m.api.get_bytes_sent(e)}),e},onResponse(e){return l.dispatch("network/add_bytes_received",{from:"assets",bytes:m.api.get_bytes_received(e)}),e}});var _={meta:ye,livestream:be,events:Ee,viewers:Ae,assets:Te},Pe={namespaced:!0,state:{livestream:null},mutations:{SET_LIVESTREAM:(e,t)=>e.livestream=t},getters:{get_livestream:e=>e.livestream},actions:{fetch_livestream({commit:e}){return new Promise((t,s)=>_.livestream.get().then(r=>{e("SET_LIVESTREAM",r),t(r)}).catch(r=>s(r)))},async get_livestream({getters:e,dispatch:t}){return e.get_livestream||await t("fetch_livestream")},socket_streamUpdate({commit:e},t){e("SET_LIVESTREAM",t),logger.info("SOCK",`got livestream update: ${t.status}`)}}},Re={namespaced:!0,state:{events:[]},mutations:{SET_EVENTS:(e,t)=>e.events=t,SET_EVENT:(e,t)=>{const s=e.events.find(r=>r.slug==t.slug);s?e.events[e.events.indexOf(s)]=t:e.events.push(t)}},getters:{get_events:e=>e.events,get_event:e=>t=>e.events.find(s=>s.slug===t),event_slugs:e=>e.events.map(t=>t.slug)},actions:{fetch_events_count(){return new Promise((e,t)=>_.events.count().then(s=>e(s)).catch(s=>t(s)))},fetch_events({commit:e}){return new Promise((t,s)=>_.events.getAll().then(r=>{e("SET_EVENTS",r),t(r)}).catch(r=>s(r)))},fetch_event({commit:e},t){return new Promise((s,r)=>_.events.get(t).then(n=>{e("SET_EVENT",n),s(n)}).catch(n=>r(n)))},async get_events({getters:e,dispatch:t}){const s=e.get_events.length;let r;try{r=await t("fetch_events_count")}catch{r=s}return r>s?await t("fetch_events"):e.get_events},async get_event({getters:e,dispatch:t},s){return e.get_event(s)||await t("fetch_event",s)}}},ke={namespaced:!0,state:{transfers:{assets:{bytes_sent:0,bytes_received:0},api:{bytes_sent:0,bytes_received:0},socket:{bytes_sent:0,bytes_received:0},mux:{bytes_sent:0,bytes_received:0}}},mutations:{ADD_BYTES_SENT:(e,{to:t,bytes:s})=>{e.transfers[t].bytes_sent+=s},ADD_BYTES_RECEIVED:(e,{from:t,bytes:s})=>{e.transfers[t].bytes_received+=s}},getters:{total_bytes_sent:e=>Object.values(e.transfers).map(t=>t.bytes_sent).reduce((t,s)=>t+s),total_bytes_received:e=>Object.values(e.transfers).map(t=>t.bytes_received).reduce((t,s)=>t+s),total_bytes_transferred:(e,t)=>t.total_bytes_sent+t.total_bytes_received},actions:{add_bytes_sent({commit:e},{to:t,bytes:s}){e("ADD_BYTES_SENT",{to:t,bytes:s}),c.info("STORE",`Sent ${s} bytes to ${t}.`)},add_bytes_received({commit:e},{from:t,bytes:s}){e("ADD_BYTES_RECEIVED",{from:t,bytes:s}),c.info("STORE",`Received ${s} bytes from ${t}.`)}}};const k=()=>({meta:null,isMobile:!1,colorPalette:["background","background2","body","highlight","controls","chat"],activeClasses:["active"],users:{},chat:{},announcements:{},uid:localStorage.uid?localStorage.uid:null,blocked:!1,count:0,isAdmin:localStorage.admin?JSON.parse(localStorage.admin):!1});var l=F({strict:!1,state:k(),modules:{livestream:Pe,events:Re,network:ke},mutations:{SET_META:(e,t)=>e.meta=t,SET_MOBILE:(e,t)=>e.isMobile=t,setUsers:(e,t)=>e.users=t,setUser:(e,t)=>e.users[t.uid]=t,setChat:(e,t)=>e.chat=t,setMessage:(e,t)=>e.chat[t.time]=t,setAnnouncements:(e,t)=>e.announcements=t,setAnnouncement:(e,t)=>e.announcements[t.time]=t,setUid:(e,t)=>e.uid=t,setBlock:(e,t)=>e.blocked=t,setCount:(e,t)=>e.count=t,setMobile:(e,t)=>e.isMobile=t,adminify:e=>e.isAdmin=!0,RESET:e=>{const t=k();Object.keys(t).forEach(s=>e[s]=t[s])}},getters:{meta:e=>e.meta,isActive:e=>t=>[...e.activeClasses,e.metainfo.buttonWhenStreamIsActive,e.metainfo.buttonWhenStreamIsRewatchable].includes(t),chatArray:e=>Object.values(e.chat),chatByTime:(e,t)=>{let s=[];return e.isMobile?s=[...t.chatArray,...t.publishedAnns].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>{const o=r.publishedAt||r.time,a=n.publishedAt||n.time;return o-a}):s=[...t.chatArray].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>r.time-n.time),s},publishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt>0).sort((s,r)=>s.publishedAt-r.publishedAt),unpublishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt==0).sort((s,r)=>s.time-r.time),announcementsArray:e=>Object.values(e.announcements).filter(t=>t.deleted===!1)},actions:{fetchMeta({commit:e}){return new Promise((t,s)=>_.meta.get().then(r=>{e("SET_META",r),t(r)}).catch(r=>s(r)))},async getMeta({getters:e,dispatch:t}){return e.meta||await t("fetchMeta")},reset({commit:e}){e("RESET")},registerBroadcasts({state:e,commit:t},s){t("setBroadcasts",s.map(r=>p(u({},r),{theme:e.colorPalette.map(n=>({[`--${n}`]:r[n]})),isInPast:new Date>new Date(r.FilmEndsOn),isInFuture:new Date<new Date(r.LiveStartsOn)})))},socket_user({state:e,commit:t},s){t("setUser",s),e.uid&&s.uid===e.uid&&!e.isAdmin&&(s.blocked?(logger.warn("STORE","blocked"),t("setBlock",!0)):(logger.warn("STORE","unblocked"),t("setBlock",!1)))},socket_userConfirm({commit:e},t){logger.info("STORE","Your User ID:",t),e("setUid",t),localStorage.uid=t},socket_count({commit:e},t){e("setCount",t)},socket_clearchat({commit:e}){e("setChat",{})},socket_clearusers({commit:e}){e("setUsers",{}),localStorage.clear(),window.location.reload(!0)},register({state:e},t){this._vm.$socket.client.emit("user",{name:t,blocked:!1})},deleteMessage(e,t){this._vm.$socket.client.emit("message",p(u({},t),{deleted:!0}))},adminify({commit:e},t){t==="yellow"&&(e("adminify"),localStorage.administrator=!0)}}});const O=x({history:H("/"),routes:[{path:"/",name:"home",component:()=>h(()=>import("./Home.3b045119.js"),["assets/Home.3b045119.js","assets/vendor.4944b02c.js"]),beforeEnter:async()=>await Le()},{path:"/about",name:"about",component:()=>h(()=>import("./About.24127396.js"),["assets/About.24127396.js","assets/About.3def71d6.css","assets/vendor.4944b02c.js"])},{path:"/404",name:"Page Not Found",component:()=>h(()=>import("./404.02a5d943.js"),["assets/404.02a5d943.js","assets/vendor.4944b02c.js"])},{path:"/:slug",name:"event",component:()=>h(()=>import("./Event.adf7f93b.js"),["assets/Event.adf7f93b.js","assets/vendor.4944b02c.js"]),beforeEnter:async e=>await Ue(e.params.slug)},{path:"/:pathMatch(.*)*",redirect:{name:"Page Not Found"}}]}),$e=async e=>{try{await l.dispatch("livestream/get_livestream")}catch{return"404"}},Le=async()=>{try{await l.dispatch("events/get_events")}catch{return"404"}},Ue=async e=>{try{await l.dispatch("events/get_event",e)}catch(t){return c.error("ROUTER",`Event page ${e} not found.`,t),"404"}};O.beforeEach(async e=>await $e());var Oe=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s};const De={name:"App",setup(){j({base:{href:"/vue-router",target:"_blank"},charset:"utf8",title:"My Title"})},components:{RouterLink:G,RouterView:K},computed:u({},Y("network",["total_bytes_sent","total_bytes_received","total_bytes_transferred"])),methods:{format_bytes:m.format_bytes},async created(){const e=document.querySelectorAll("script"),t=document.querySelectorAll("link");for(const s of e)if(s.src&&!s.src.includes("@"))try{await _.assets.head(s.src)}catch(r){console.log(r)}for(const s of t)if(s.href&&!s.href.includes("@"))try{await _.assets.head(s.href)}catch(r){console.log(r)}}},Ie={class:"wrapper"},Me=i("h1",null,"The Hmm Livestream",-1),Ce=L("Home"),Be=L("About"),Ve=i("br",null,null,-1),Ne={id:"network"},Fe=i("td",null,"total bytes sent",-1),xe=i("td",null,"total bytes received",-1),He=i("td",null,"total bytes transferred",-1);function je(e,t,s,r,n,o){const a=S("RouterLink"),f=S("RouterView");return q(),z(W,null,[i("header",null,[i("div",Ie,[Me,i("nav",null,[v(a,{to:"/"},{default:P(()=>[Ce]),_:1}),v(a,{to:"/about"},{default:P(()=>[Be]),_:1})]),Ve,i("table",Ne,[i("tr",null,[Fe,i("td",null,g(o.format_bytes(e.total_bytes_sent)),1)]),i("tr",null,[xe,i("td",null,g(o.format_bytes(e.total_bytes_received)),1)]),i("tr",null,[He,i("td",null,g(o.format_bytes(e.total_bytes_transferred)),1)])])])]),v(f)],64)}var Ge=Oe(De,[["render",je]]);c.intro(E);const D=J(Ge);Z.polyfill();D.config.globalProperties={logger:c,$id:ge};D.use(Q,X(E.socketURL),{store:l}).use(l).use(O).use(ee()).mount("#app");export{Oe as _};
