var D=Object.defineProperty,M=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var E=(e,t,s)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t||(t={}))I.call(t,s)&&E(e,s,t[s]);if(y)for(var s of y(t))B.call(t,s)&&E(e,s,t[s]);return e},h=(e,t)=>M(e,C(t));import{j as A,a as u,H as V,c as N,b as F,d as x,u as H,R as j,e as G,m as K,r as T,o as Y,f as z,g as i,h as p,w,t as v,F as W,i as R,k as q,s as J,P as Z,l as Q,n as X}from"./vendor.4944b02c.js";const ee=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};ee();const te="modulepreload",S={},se="/",m=function(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${se}${r}`,r in S)return;S[r]=!0;const n=r.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":te,n||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),n)return new Promise((f,U)=>{a.addEventListener("load",f),a.addEventListener("error",U)})})).then(()=>t())},k={VITE_APP_SOCKET_URL:"https://api.live.thehmm.karls.computer",VITE_APP_API_URL:"https://api.live.thehmm.karls.computer/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},re=k.VITE_APP_API_URL,ne=k.VITE_APP_SOCKET_URL,oe={html:!0,linkify:!0,typographer:!0,emoji:!0,breaks:!0};var b={apiURL:re,socketURL:ne,md:oe};const ae=(e,...t)=>{for(const s of t)typeof s=="object"?(console.log(`- ${e.toUpperCase()}:`),console.log(s)):console.log(`- ${e.toUpperCase()}: ${s}`)},$=(e,...t)=>{for(const s of t)typeof s=="object"?(console.info(`* ${e.toUpperCase()}:`),console.info(s)):console.info(`* ${e.toUpperCase()}: ${s}`)},ie=(e,...t)=>{for(const s of t)console.warn(`! ${e.toUpperCase()}: ${s}`)},ce=(e,...t)=>{for(const s of t)console.error(`x ${e.toUpperCase()}: ${s}`)},le=(e,...t)=>{for(const s of t)$(`x ${e.toUpperCase()}:`),console.table(`x ${e.toUpperCase()}: ${s}`)},ue=e=>{console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info("* * * * * * * * * * * The Hmm * * * * * * * * * * * *"),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info(`* API => ${e.apiURL} *`),console.info(`* SOCKETS => ${e.socketURL} *`),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log()};var c={log:ae,info:$,warn:ie,error:ce,table:le,intro:ue};const _e=(e,t=3)=>{if(e===0)return"0 Bytes";const s=1024,r=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(r))+" "+n[o]},de={},me={get_bytes_sent(e){return A(e)+84},get_bytes_received(e){const s=e.data,r=e.headers,n=+r["content-length"]||s.length,o=A(r)-54;return n+o}},fe={},he={};var g={format_bytes:_e,assets:de,api:me,socket:fe,mux:he};function pe(){var e,t;return(t=(e=this.$options)==null?void 0:e.name)==null?void 0:t.toLowerCase()}u.defaults.baseURL=b.apiURL;const ve={get(){return new Promise(async(e,t)=>u.get("meta").then(s=>e(s.data.data.attributes)).catch(s=>t(s)))}},ge={get(){return c.info("API","Fetching livestream."),new Promise((e,t)=>u.get("livestream").then(s=>e(s.data.data.attributes.publicData)).catch(s=>t(s)))}},be={count(){return c.info("API","Counting events."),new Promise((e,t)=>{u.get("events/count").then(s=>e(s.data)).catch(s=>t(s))})},getAll(){return c.info("API","Fetching events."),new Promise((e,t)=>{u.get("events").then(s=>{const r=s.data.data;for(let n=0;n<r.length;n++)r[n]=l(l({},r[n]),r[n].attributes),delete r[n].attributes;e(r)}).catch(s=>t(s))})},get(e){return c.info("API",`Fetching event ${e}.`),new Promise((t,s)=>{u.get(`events/${e}`).then(r=>{const n=r.data.data,o=l(l({},n),n.attributes);delete o.attributes,t(o)}).catch(r=>s(r))})}},ye={get(e){return new Promise((t,s)=>u.get("viewers",{params:{uuid:e}}).then(r=>t(r.data)).catch(r=>s(r)))}},Ee=new V(u);Ee.register({onRequest(e){return _.dispatch("network/add_bytes_sent",{to:"api",bytes:g.api.get_bytes_sent(e)}),e},onResponse(e){return _.dispatch("network/add_bytes_received",{from:"api",bytes:g.api.get_bytes_received(e)}),e}});var d={meta:ve,livestream:ge,events:be,viewers:ye},Ae={namespaced:!0,state:{livestream:null},mutations:{SET_LIVESTREAM:(e,t)=>e.livestream=t},getters:{get_livestream:e=>e.livestream},actions:{fetch_livestream({commit:e}){return new Promise((t,s)=>d.livestream.get().then(r=>{e("SET_LIVESTREAM",r),t(r)}).catch(r=>s(r)))},async get_livestream({getters:e,dispatch:t}){return e.get_livestream||await t("fetch_livestream")},socket_streamUpdate({commit:e},t){e("SET_LIVESTREAM",t),logger.info("SOCK",`got livestream update: ${t.status}`)}}},Te={namespaced:!0,state:{events:[]},mutations:{SET_EVENTS:(e,t)=>e.events=t,SET_EVENT:(e,t)=>{const s=e.events.find(r=>r.slug==t.slug);s?e.events[e.events.indexOf(s)]=t:e.events.push(t)}},getters:{get_events:e=>e.events,get_event:e=>t=>e.events.find(s=>s.slug===t),event_slugs:e=>e.events.map(t=>t.slug)},actions:{fetch_events_count(){return new Promise((e,t)=>d.events.count().then(s=>e(s)).catch(s=>t(s)))},fetch_events({commit:e}){return new Promise((t,s)=>d.events.getAll().then(r=>{e("SET_EVENTS",r),t(r)}).catch(r=>s(r)))},fetch_event({commit:e},t){return new Promise((s,r)=>d.events.get(t).then(n=>{e("SET_EVENT",n),s(n)}).catch(n=>r(n)))},async get_events({getters:e,dispatch:t}){const s=e.get_events.length;let r;try{r=await t("fetch_events_count")}catch{r=s}return r>s?await t("fetch_events"):e.get_events},async get_event({getters:e,dispatch:t},s){return e.get_event(s)||await t("fetch_event",s)}}},we={namespaced:!0,state:{transfers:{assets:{bytes_sent:0,bytes_received:0},api:{bytes_sent:0,bytes_received:0},socket:{bytes_sent:0,bytes_received:0},mux:{bytes_sent:0,bytes_received:0}}},mutations:{ADD_BYTES_SENT:(e,{to:t,bytes:s})=>{e.transfers[t].bytes_sent+=s},ADD_BYTES_RECEIVED:(e,{from:t,bytes:s})=>{e.transfers[t].bytes_received+=s}},getters:{total_bytes_sent:e=>Object.values(e.transfers).map(t=>t.bytes_sent).reduce((t,s)=>t+s),total_bytes_received:e=>Object.values(e.transfers).map(t=>t.bytes_received).reduce((t,s)=>t+s),total_bytes_transferred:(e,t)=>t.total_bytes_sent+t.total_bytes_received},actions:{add_bytes_sent({commit:e},{to:t,bytes:s}){e("ADD_BYTES_SENT",{to:t,bytes:s}),c.info("STORE",`Sent ${s} bytes to ${t}.`)},add_bytes_received({commit:e},{from:t,bytes:s}){e("ADD_BYTES_RECEIVED",{from:t,bytes:s}),c.info("STORE",`Received ${s} bytes from ${t}.`)}}};const P=()=>({meta:null,isMobile:!1,colorPalette:["background","background2","body","highlight","controls","chat"],activeClasses:["active"],users:{},chat:{},announcements:{},uid:localStorage.uid?localStorage.uid:null,blocked:!1,count:0,isAdmin:localStorage.admin?JSON.parse(localStorage.admin):!1});var _=N({strict:!1,state:P(),modules:{livestream:Ae,events:Te,network:we},mutations:{SET_META:(e,t)=>e.meta=t,SET_MOBILE:(e,t)=>e.isMobile=t,setUsers:(e,t)=>e.users=t,setUser:(e,t)=>e.users[t.uid]=t,setChat:(e,t)=>e.chat=t,setMessage:(e,t)=>e.chat[t.time]=t,setAnnouncements:(e,t)=>e.announcements=t,setAnnouncement:(e,t)=>e.announcements[t.time]=t,setUid:(e,t)=>e.uid=t,setBlock:(e,t)=>e.blocked=t,setCount:(e,t)=>e.count=t,setMobile:(e,t)=>e.isMobile=t,adminify:e=>e.isAdmin=!0,RESET:e=>{const t=P();Object.keys(t).forEach(s=>e[s]=t[s])}},getters:{meta:e=>e.meta,isActive:e=>t=>[...e.activeClasses,e.metainfo.buttonWhenStreamIsActive,e.metainfo.buttonWhenStreamIsRewatchable].includes(t),chatArray:e=>Object.values(e.chat),chatByTime:(e,t)=>{let s=[];return e.isMobile?s=[...t.chatArray,...t.publishedAnns].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>{const o=r.publishedAt||r.time,a=n.publishedAt||n.time;return o-a}):s=[...t.chatArray].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>r.time-n.time),s},publishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt>0).sort((s,r)=>s.publishedAt-r.publishedAt),unpublishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt==0).sort((s,r)=>s.time-r.time),announcementsArray:e=>Object.values(e.announcements).filter(t=>t.deleted===!1)},actions:{fetchMeta({commit:e}){return new Promise((t,s)=>d.meta.get().then(r=>{e("SET_META",r),t(r)}).catch(r=>s(r)))},async getMeta({getters:e,dispatch:t}){return e.meta||await t("fetchMeta")},reset({commit:e}){e("RESET")},registerBroadcasts({state:e,commit:t},s){t("setBroadcasts",s.map(r=>h(l({},r),{theme:e.colorPalette.map(n=>({[`--${n}`]:r[n]})),isInPast:new Date>new Date(r.FilmEndsOn),isInFuture:new Date<new Date(r.LiveStartsOn)})))},socket_user({state:e,commit:t},s){t("setUser",s),e.uid&&s.uid===e.uid&&!e.isAdmin&&(s.blocked?(logger.warn("STORE","blocked"),t("setBlock",!0)):(logger.warn("STORE","unblocked"),t("setBlock",!1)))},socket_userConfirm({commit:e},t){logger.info("STORE","Your User ID:",t),e("setUid",t),localStorage.uid=t},socket_count({commit:e},t){e("setCount",t)},socket_clearchat({commit:e}){e("setChat",{})},socket_clearusers({commit:e}){e("setUsers",{}),localStorage.clear(),window.location.reload(!0)},register({state:e},t){this._vm.$socket.client.emit("user",{name:t,blocked:!1})},deleteMessage(e,t){this._vm.$socket.client.emit("message",h(l({},t),{deleted:!0}))},adminify({commit:e},t){t==="yellow"&&(e("adminify"),localStorage.administrator=!0)}}});const L=F({history:x("/"),routes:[{path:"/",name:"home",component:()=>m(()=>import("./Home.729824dd.js"),["assets/Home.729824dd.js","assets/vendor.4944b02c.js"]),beforeEnter:async()=>await Pe()},{path:"/about",name:"about",component:()=>m(()=>import("./About.25a9d38b.js"),["assets/About.25a9d38b.js","assets/About.3def71d6.css","assets/vendor.4944b02c.js"])},{path:"/404",name:"Page Not Found",component:()=>m(()=>import("./404.d81867da.js"),["assets/404.d81867da.js","assets/vendor.4944b02c.js"])},{path:"/:slug",name:"event",component:()=>m(()=>import("./Event.a03fb1b1.js"),["assets/Event.a03fb1b1.js","assets/vendor.4944b02c.js"]),beforeEnter:async e=>await Re(e.params.slug)},{path:"/:pathMatch(.*)*",redirect:{name:"Page Not Found"}}]}),Se=async e=>{try{await _.dispatch("livestream/get_livestream")}catch{return"404"}},Pe=async()=>{try{await _.dispatch("events/get_events")}catch{return"404"}},Re=async e=>{try{await _.dispatch("events/get_event",e)}catch(t){return c.error("ROUTER",`Event page ${e} not found.`,t),"404"}};L.beforeEach(async e=>await Se());var ke=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s};const $e={name:"App",setup(){H({base:{href:"/vue-router",target:"_blank"},charset:"utf8",title:"My Title"})},components:{RouterLink:j,RouterView:G},computed:l({},K("network",["total_bytes_sent","total_bytes_received","total_bytes_transferred"])),methods:{format_bytes:g.format_bytes}},Le={class:"wrapper"},Oe=i("h1",null,"The Hmm Livestream",-1),Ue=R("Home"),De=R("About"),Me=i("br",null,null,-1),Ce={id:"network"},Ie=i("td",null,"total bytes sent",-1),Be=i("td",null,"total bytes received",-1),Ve=i("td",null,"total bytes transferred",-1);function Ne(e,t,s,r,n,o){const a=T("RouterLink"),f=T("RouterView");return Y(),z(W,null,[i("header",null,[i("div",Le,[Oe,i("nav",null,[p(a,{to:"/"},{default:w(()=>[Ue]),_:1}),p(a,{to:"/about"},{default:w(()=>[De]),_:1})]),Me,i("table",Ce,[i("tr",null,[Ie,i("td",null,v(o.format_bytes(e.total_bytes_sent)),1)]),i("tr",null,[Be,i("td",null,v(o.format_bytes(e.total_bytes_received)),1)]),i("tr",null,[Ve,i("td",null,v(o.format_bytes(e.total_bytes_transferred)),1)])])])]),p(f)],64)}var Fe=ke($e,[["render",Ne]]);c.intro(b);const O=q(Fe);J.polyfill();O.config.globalProperties={logger:c,$id:pe};O.use(Z,Q(b.socketURL),{store:_}).use(_).use(L).use(X()).mount("#app");export{ke as _};
