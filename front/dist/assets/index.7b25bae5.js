var D=Object.defineProperty,M=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var S=(e,t,s)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t)=>{for(var s in t||(t={}))B.call(t,s)&&S(e,s,t[s]);if(A)for(var s of A(t))V.call(t,s)&&S(e,s,t[s]);return e},g=(e,t)=>M(e,C(t));import{H as N,a as d,j as T,c as F,b as H,d as x,u as j,R as G,e as K,m as Y,r as w,o as q,f as z,g as c,h as b,w as P,t as E,F as W,i as $,k as J,s as Z,P as Q,l as X,n as ee}from"./vendor.5c5858dd.js";const te=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};te();const se="modulepreload",R={},re="/",f=function(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${re}${r}`,r in R)return;R[r]=!0;const n=r.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":se,n||(a.as="script",a.crossOrigin=""),a.href=r,document.head.appendChild(a),n)return new Promise((v,O)=>{a.addEventListener("load",v),a.addEventListener("error",O)})})).then(()=>t())},y={VITE_APP_URL:"https://live.thehmm.karls.computer",VITE_APP_SOCKET_URL:"https://api.live.thehmm.karls.computer",VITE_APP_API_URL:"https://api.live.thehmm.karls.computer/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},ne=y.VITE_APP_URL,oe=y.VITE_APP_API_URL,ae=y.VITE_APP_SOCKET_URL,ie={html:!0,linkify:!0,typographer:!0,emoji:!0,breaks:!0};var p={URL:ne,apiURL:oe,socketURL:ae,md:ie};const ce=(e,...t)=>{for(const s of t)typeof s=="object"?(console.log(`- ${e.toUpperCase()}:`),console.log(s)):console.log(`- ${e.toUpperCase()}: ${s}`)},I=(e,...t)=>{for(const s of t)typeof s=="object"?(console.info(`* ${e.toUpperCase()}:`),console.info(s)):console.info(`* ${e.toUpperCase()}: ${s}`)},le=(e,...t)=>{for(const s of t)console.warn(`! ${e.toUpperCase()}: ${s}`)},ue=(e,...t)=>{for(const s of t)console.error(`x ${e.toUpperCase()}: ${s}`)},de=(e,...t)=>{for(const s of t)I(`x ${e.toUpperCase()}:`),console.table(`x ${e.toUpperCase()}: ${s}`)},_e=e=>{console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info("* * * * * * * * * * * The Hmm * * * * * * * * * * * *"),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info(`* API => ${e.apiURL} *`),console.info(`* SOCKETS => ${e.socketURL} *`),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log()};var i={log:ce,info:I,warn:le,error:ue,table:de,intro:_e};const he=(e,t=3)=>{if(e===0)return"0 Bytes";const s=1024,r=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(r))+" "+n[o]},me={},m={url:p.apiURL,get_bytes_sent(e){return T(e)+84},get_bytes_received(e){const s=e.data,r=e.headers,n=+r["content-length"]||s.length,o=T(r)-54;return n+o}},fe={},pe={},ve=new N(d);ve.register({onRequest(e){const t=e.url,s=t.includes(m.url)?"api":"assets",r=m.get_bytes_sent(e);return _.dispatch("network/add_bytes_sent",{url:t,to:s,bytes:r}),e},onResponse(e){const t=e.request.responseURL,s=t.includes(m.url)?"api":"assets",r=m.get_bytes_received(e);return _.dispatch("network/add_bytes_received",{url:t,from:s,bytes:r}),e}});var ge={format_bytes:he,assets:me,api:m,socket:fe,mux:pe};function be(){var e,t;return(t=(e=this.$options)==null?void 0:e.name)==null?void 0:t.toLowerCase()}const h=p.apiURL,Ee={get:()=>new Promise(async e=>d.get(`${h}/meta`).then(t=>e(t.data.data.attributes)).catch(t=>i.error("API",t)))},ye={get:()=>(i.info("API","Fetching livestream."),new Promise(e=>d.get(`${h}/livestream`).then(t=>e(t.data.data.attributes.publicData)).catch(t=>i.error("API",t))))},Ae={count:()=>(i.info("API","Counting events."),new Promise(e=>{d.get(`${h}/events/count`).then(t=>e(t.data)).catch(t=>i.error("API",t))})),getAll:()=>(i.info("API","Fetching events."),new Promise(e=>{d.get(`${h}/events`).then(t=>{const s=t.data.data;for(let r=0;r<s.length;r++)s[r]=u(u({},s[r]),s[r].attributes),delete s[r].attributes;e(s)}).catch(t=>i.error("API",t))})),get:e=>(i.info("API",`Fetching event ${e}.`),new Promise(t=>{d.get(`${h}/events/${e}`).then(s=>{const r=s.data.data,n=u(u({},r),r.attributes);delete n.attributes,t(n)}).catch(s=>i.error("API",s))}))},Se={get:e=>new Promise(t=>d.get(`${h}/viewers`,{params:{uuid:e}}).then(s=>t(s.data)).catch(s=>i.error("API",s)))},Te={head:e=>(_.getters["network/is_registered_asset"](e)&&i.warn("API",`Not HEAD-ing registered url ${e}`),i.info("API",`Heading asset ${e}.`),new Promise(t=>d.head(e).then(s=>t(s)).catch(s=>i.error("API",s))))};var l={meta:Ee,livestream:ye,events:Ae,viewers:Se,assets:Te},we={namespaced:!0,state:{livestream:null},mutations:{SET_LIVESTREAM:(e,t)=>e.livestream=t},getters:{get_livestream:e=>e.livestream},actions:{fetch_livestream({commit:e}){return new Promise((t,s)=>l.livestream.get().then(r=>{e("SET_LIVESTREAM",r),t(r)}).catch(r=>s(r)))},async get_livestream({getters:e,dispatch:t}){return e.get_livestream||await t("fetch_livestream")},socket_streamUpdate({commit:e},t){e("SET_LIVESTREAM",t),logger.info("SOCK",`got livestream update: ${t.status}`)}}},Pe={namespaced:!0,state:{events:[]},mutations:{SET_EVENTS:(e,t)=>e.events=t,SET_EVENT:(e,t)=>{const s=e.events.find(r=>r.slug==t.slug);s?e.events[e.events.indexOf(s)]=t:e.events.push(t)}},getters:{get_events:e=>e.events,get_event:e=>t=>e.events.find(s=>s.slug===t),event_slugs:e=>e.events.map(t=>t.slug)},actions:{fetch_events_count(){return new Promise((e,t)=>l.events.count().then(s=>e(s)).catch(s=>t(s)))},fetch_events({commit:e}){return new Promise((t,s)=>l.events.getAll().then(r=>{e("SET_EVENTS",r),t(r)}).catch(r=>s(r)))},fetch_event({commit:e},t){return new Promise((s,r)=>l.events.get(t).then(n=>{e("SET_EVENT",n),s(n)}).catch(n=>r(n)))},async get_events({getters:e,dispatch:t}){const s=e.get_events.length;let r;try{r=await t("fetch_events_count")}catch{r=s}return r>s?await t("fetch_events"):e.get_events},async get_event({getters:e,dispatch:t},s){return e.get_event(s)||await t("fetch_event",s)}}},Re={namespaced:!0,state:{transfers:{assets:{bytes_sent:0,bytes_received:0,registered:[]},api:{bytes_sent:0,bytes_received:0},socket:{bytes_sent:0,bytes_received:0},mux:{bytes_sent:0,bytes_received:0}}},mutations:{ADD_BYTES_SENT:(e,{to:t,bytes:s})=>{e.transfers[t].bytes_sent+=s},ADD_BYTES_RECEIVED:(e,{from:t,bytes:s})=>{e.transfers[t].bytes_received+=s},REGISTER_ASSET:(e,t)=>{e.transfers.assets.registered.push(t)}},getters:{total_bytes_sent:e=>Object.values(e.transfers).map(t=>t.bytes_sent).reduce((t,s)=>t+s),total_bytes_received:e=>Object.values(e.transfers).map(t=>t.bytes_received).reduce((t,s)=>t+s),total_bytes_transferred:(e,t)=>t.total_bytes_sent+t.total_bytes_received,is_registered_asset:e=>t=>e.transfers.assets.registered.find(s=>s.includes(t))},actions:{add_bytes_sent({commit:e},{url:t,to:s,bytes:r}){e("ADD_BYTES_SENT",{to:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),i.info("STORE",`Sent ${r} bytes to ${s}.`)},add_bytes_received({commit:e},{url:t,from:s,bytes:r}){e("ADD_BYTES_RECEIVED",{from:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),i.info("STORE",`Received ${r} bytes from ${s}.`)}}};const k=()=>({meta:null,isMobile:!1,colorPalette:["background","background2","body","highlight","controls","chat"],activeClasses:["active"],users:{},chat:{},announcements:{},uid:localStorage.uid?localStorage.uid:null,blocked:!1,count:0,isAdmin:localStorage.admin?JSON.parse(localStorage.admin):!1});var _=F({strict:!1,state:k(),modules:{livestream:we,events:Pe,network:Re},mutations:{SET_META:(e,t)=>e.meta=t,SET_MOBILE:(e,t)=>e.isMobile=t,setUsers:(e,t)=>e.users=t,setUser:(e,t)=>e.users[t.uid]=t,setChat:(e,t)=>e.chat=t,setMessage:(e,t)=>e.chat[t.time]=t,setAnnouncements:(e,t)=>e.announcements=t,setAnnouncement:(e,t)=>e.announcements[t.time]=t,setUid:(e,t)=>e.uid=t,setBlock:(e,t)=>e.blocked=t,setCount:(e,t)=>e.count=t,setMobile:(e,t)=>e.isMobile=t,adminify:e=>e.isAdmin=!0,RESET:e=>{const t=k();Object.keys(t).forEach(s=>e[s]=t[s])}},getters:{meta:e=>e.meta,isActive:e=>t=>[...e.activeClasses,e.metainfo.buttonWhenStreamIsActive,e.metainfo.buttonWhenStreamIsRewatchable].includes(t),chatArray:e=>Object.values(e.chat),chatByTime:(e,t)=>{let s=[];return e.isMobile?s=[...t.chatArray,...t.publishedAnns].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>{const o=r.publishedAt||r.time,a=n.publishedAt||n.time;return o-a}):s=[...t.chatArray].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>r.time-n.time),s},publishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt>0).sort((s,r)=>s.publishedAt-r.publishedAt),unpublishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt==0).sort((s,r)=>s.time-r.time),announcementsArray:e=>Object.values(e.announcements).filter(t=>t.deleted===!1)},actions:{fetchMeta({commit:e}){return new Promise((t,s)=>l.meta.get().then(r=>{e("SET_META",r),t(r)}).catch(r=>s(r)))},async getMeta({getters:e,dispatch:t}){return e.meta||await t("fetchMeta")},reset({commit:e}){e("RESET")},registerBroadcasts({state:e,commit:t},s){t("setBroadcasts",s.map(r=>g(u({},r),{theme:e.colorPalette.map(n=>({[`--${n}`]:r[n]})),isInPast:new Date>new Date(r.FilmEndsOn),isInFuture:new Date<new Date(r.LiveStartsOn)})))},socket_user({state:e,commit:t},s){t("setUser",s),e.uid&&s.uid===e.uid&&!e.isAdmin&&(s.blocked?(logger.warn("STORE","blocked"),t("setBlock",!0)):(logger.warn("STORE","unblocked"),t("setBlock",!1)))},socket_userConfirm({commit:e},t){logger.info("STORE","Your User ID:",t),e("setUid",t),localStorage.uid=t},socket_count({commit:e},t){e("setCount",t)},socket_clearchat({commit:e}){e("setChat",{})},socket_clearusers({commit:e}){e("setUsers",{}),localStorage.clear(),window.location.reload(!0)},register({state:e},t){this._vm.$socket.client.emit("user",{name:t,blocked:!1})},deleteMessage(e,t){this._vm.$socket.client.emit("message",g(u({},t),{deleted:!0}))},adminify({commit:e},t){t==="yellow"&&(e("adminify"),localStorage.administrator=!0)}}});const L=H({history:x("/"),routes:[{path:"/",name:"home",component:()=>f(()=>import("./Home.54a86966.js"),["assets/Home.54a86966.js","assets/vendor.5c5858dd.js"]),beforeEnter:async()=>await $e()},{path:"/about",name:"about",component:()=>f(()=>import("./About.cf0d2c03.js"),["assets/About.cf0d2c03.js","assets/About.3def71d6.css","assets/vendor.5c5858dd.js"])},{path:"/404",name:"Page Not Found",component:()=>f(()=>import("./404.ab1a929b.js"),["assets/404.ab1a929b.js","assets/vendor.5c5858dd.js"])},{path:"/:slug",name:"event",component:()=>f(()=>import("./Event.7c413f2e.js"),["assets/Event.7c413f2e.js","assets/vendor.5c5858dd.js"]),beforeEnter:async e=>await Ie(e.params.slug)},{path:"/:pathMatch(.*)*",redirect:{name:"Page Not Found"}}]}),ke=async e=>{try{await _.dispatch("livestream/get_livestream")}catch{return"404"}},$e=async()=>{try{await _.dispatch("events/get_events")}catch{return"404"}},Ie=async e=>{try{await _.dispatch("events/get_event",e)}catch(t){return i.error("ROUTER",`Event page ${e} not found.`,t),"404"}};L.beforeEach(async e=>await ke());var Le=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s};const Ue={name:"App",setup(){j({base:{href:"/vue-router",target:"_blank"},charset:"utf8",title:"My Title"})},components:{RouterLink:G,RouterView:K},data(){return{observer:null}},computed:u({},Y("network",["total_bytes_sent","total_bytes_received","total_bytes_transferred"])),methods:{format_bytes:ge.format_bytes,async head_assets(){await l.assets.head("index.html");const e=document.querySelectorAll("script"),t=document.querySelectorAll("link");for(const s of e)s.src&&!s.src.includes("@")&&await l.assets.head(s.src);for(const s of t)s.href&&await l.assets.head(s.href)}},async created(){this.head_assets()},mounted(){this.observer=new MutationObserver(e=>{e.forEach(t=>{console.log("new mutation:",t),t.addedNodes.forEach(s=>{(s.href||s.src)&&l.assets.head(s.href||s.src)})})}),this.observer.observe(document.head,{childList:!0})},beforedestroy(){this.observer.disconnect}},Oe={class:"wrapper"},De=c("h1",null,"The Hmm Livestream",-1),Me=$("Home"),Ce=$("About"),Be=c("br",null,null,-1),Ve={id:"network"},Ne=c("td",null,"total bytes sent",-1),Fe=c("td",null,"total bytes received",-1),He=c("td",null,"total bytes transferred",-1);function xe(e,t,s,r,n,o){const a=w("RouterLink"),v=w("RouterView");return q(),z(W,null,[c("header",null,[c("div",Oe,[De,c("nav",null,[b(a,{to:"/"},{default:P(()=>[Me]),_:1}),b(a,{to:"/about"},{default:P(()=>[Ce]),_:1})]),Be,c("table",Ve,[c("tr",null,[Ne,c("td",null,E(o.format_bytes(e.total_bytes_sent)),1)]),c("tr",null,[Fe,c("td",null,E(o.format_bytes(e.total_bytes_received)),1)]),c("tr",null,[He,c("td",null,E(o.format_bytes(e.total_bytes_transferred)),1)])])])]),b(v)],64)}var je=Le(Ue,[["render",xe]]);i.intro(p);const U=J(je);Z.polyfill();U.config.globalProperties={logger:i,$id:be};U.use(Q,X(p.socketURL),{store:_}).use(_).use(L).use(ee()).mount("#app");export{Le as _};
