var C=Object.defineProperty,B=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var S=(e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,l=(e,t)=>{for(var s in t||(t={}))N.call(t,s)&&S(e,s,t[s]);if(A)for(var s of A(t))F.call(t,s)&&S(e,s,t[s]);return e},g=(e,t)=>B(e,V(t));import{H,a as u,j as $,c as x,b as j,d as G,u as K,R as W,e as Y,m as q,r as T,o as z,f as J,g as c,h as E,w as P,t as b,F as Z,i as I,k as Q,s as X,P as ee,l as te,n as se}from"./vendor.5c5858dd.js";const re=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};re();const ne="modulepreload",w={},oe="/",f=function(t,s){return!s||s.length===0?t():Promise.all(s.map(r=>{if(r=`${oe}${r}`,r in w)return;w[r]=!0;const n=r.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${o}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":ne,n||(i.as="script",i.crossOrigin=""),i.href=r,document.head.appendChild(i),n)return new Promise((v,M)=>{i.addEventListener("load",v),i.addEventListener("error",M)})})).then(()=>t())},y={VITE_APP_URL:"https://live.thehmm.karls.computer",VITE_APP_SOCKET_URL:"https://api.live.thehmm.karls.computer",VITE_APP_API_URL:"https://api.live.thehmm.karls.computer/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0},ae=y.VITE_APP_URL,ie=y.VITE_APP_API_URL,ce=y.VITE_APP_SOCKET_URL,le={html:!0,linkify:!0,typographer:!0,emoji:!0,breaks:!0};var p={URL:ae,apiURL:ie,socketURL:ce,md:le};const ue=(e,...t)=>{for(const s of t)typeof s=="object"?(console.log(`- ${e.toUpperCase()}:`),console.log(s)):console.log(`- ${e.toUpperCase()}: ${s}`)},L=(e,...t)=>{for(const s of t)typeof s=="object"?(console.info(`* ${e.toUpperCase()}:`),console.info(s)):console.info(`* ${e.toUpperCase()}: ${s}`)},de=(e,...t)=>{for(const s of t)console.warn(`! ${e.toUpperCase()}: ${s}`)},_e=(e,...t)=>{for(const s of t)console.error(`x ${e.toUpperCase()}: ${s}`)},me=(e,...t)=>{for(const s of t)L(`x ${e.toUpperCase()}:`),console.table(`x ${e.toUpperCase()}: ${s}`)},fe=e=>{console.log(),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info("* * * * * * * * * * * The Hmm * * * * * * * * * * * *"),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.info(`* API => ${e.apiURL} *`),console.info(`* SOCKETS => ${e.socketURL} *`),console.info("* * * * * * * * * * * * * * * * * * * * * * * * * * *"),console.log()};var a={log:ue,info:L,warn:de,error:_e,table:me,intro:fe};const O=p.apiURL,he=(e,t=3)=>{if(e===0)return"0 Bytes";const s=1024,r=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,o)).toFixed(r))+" "+n[o]},pe=e=>$(e)+84,ve=e=>{const s=e.data,r=e.headers,n=+r["content-length"]||s.length,o=$(r)-54;return n+o},ge=e=>{const t=e.url,s=t.includes(O)?"api":"assets",r=pe(e);return d.dispatch("network/add_bytes_sent",{url:t,to:s,bytes:r}),e},Ee=e=>{const t=e.request.responseURL,s=t.includes(O)?"api":"assets",r=ve(e);return d.dispatch("network/add_bytes_received",{url:t,from:s,bytes:r}),e};new H(u).register({onRequest:e=>ge(e),onResponse:e=>Ee(e)});const h=async e=>{d.getters["network/is_registered_asset"](e)&&a.warn("NETWORK",`HEAD-ing registered url ${e}`);try{await m.assets.head(e)}catch(t){a.error("NETWORK",t)}},be=async()=>{h("index.html");const e=document.querySelectorAll("script"),t=document.querySelectorAll("link");for(const s of e)s.src&&!s.src.includes("@")&&h(s.src);for(const s of t)s.href&&h(s.href)};new MutationObserver(e=>{for(const t of e)for(const s of t.addedNodes)(s.href||s.src)&&h(s.href||s.src)}).observe(document.head,{childList:!0});var R={format_bytes:he,head_assets:be};function ye(){var e,t;return(t=(e=this.$options)==null?void 0:e.name)==null?void 0:t.toLowerCase()}const _=p.apiURL,Ae={get:()=>new Promise(async e=>u.get(`${_}/meta`).then(t=>e(t.data.data.attributes)).catch(t=>a.error("API",t)))},Se={get:()=>(a.info("API","Fetching livestream."),new Promise(e=>u.get(`${_}/livestream`).then(t=>e(t.data.data.attributes.publicData)).catch(t=>a.error("API",t))))},Te={count:()=>(a.info("API","Counting events."),new Promise(e=>{u.get(`${_}/events/count`).then(t=>e(t.data)).catch(t=>a.error("API",t))})),getAll:()=>(a.info("API","Fetching events."),new Promise(e=>{u.get(`${_}/events`).then(t=>{const s=t.data.data;for(let r=0;r<s.length;r++)s[r]=l(l({},s[r]),s[r].attributes),delete s[r].attributes;e(s)}).catch(t=>a.error("API",t))})),get:e=>(a.info("API",`Fetching event ${e}.`),new Promise(t=>{u.get(`${_}/events/${e}`).then(s=>{const r=s.data.data,n=l(l({},r),r.attributes);delete n.attributes,t(n)}).catch(s=>a.error("API",s))}))},Pe={get:e=>new Promise(t=>u.get(`${_}/viewers`,{params:{uuid:e}}).then(s=>t(s.data)).catch(s=>a.error("API",s)))},we={head:e=>(a.info("API",`Heading asset ${e}.`),new Promise(t=>u.head(e).then(s=>t(s)).catch(s=>a.error("API",s))))};var m={meta:Ae,livestream:Se,events:Te,viewers:Pe,assets:we},Re={namespaced:!0,state:{livestream:null},mutations:{SET_LIVESTREAM:(e,t)=>e.livestream=t},getters:{get_livestream:e=>e.livestream},actions:{fetch_livestream({commit:e}){return new Promise((t,s)=>m.livestream.get().then(r=>{e("SET_LIVESTREAM",r),t(r)}).catch(r=>s(r)))},async get_livestream({getters:e,dispatch:t}){return e.get_livestream||await t("fetch_livestream")},socket_streamUpdate({commit:e},t){e("SET_LIVESTREAM",t),logger.info("SOCK",`got livestream update: ${t.status}`)}}},ke={namespaced:!0,state:{events:[]},mutations:{SET_EVENTS:(e,t)=>e.events=t,SET_EVENT:(e,t)=>{const s=e.events.find(r=>r.slug==t.slug);s?e.events[e.events.indexOf(s)]=t:e.events.push(t)}},getters:{get_events:e=>e.events,get_event:e=>t=>e.events.find(s=>s.slug===t),event_slugs:e=>e.events.map(t=>t.slug)},actions:{fetch_events_count(){return new Promise((e,t)=>m.events.count().then(s=>e(s)).catch(s=>t(s)))},fetch_events({commit:e}){return new Promise((t,s)=>m.events.getAll().then(r=>{e("SET_EVENTS",r),t(r)}).catch(r=>s(r)))},fetch_event({commit:e},t){return new Promise((s,r)=>m.events.get(t).then(n=>{e("SET_EVENT",n),s(n)}).catch(n=>r(n)))},async get_events({getters:e,dispatch:t}){const s=e.get_events.length;let r;try{r=await t("fetch_events_count")}catch{r=s}return r>s?await t("fetch_events"):e.get_events},async get_event({getters:e,dispatch:t},s){return e.get_event(s)||await t("fetch_event",s)}}},$e={namespaced:!0,state:{transfers:{assets:{bytes_sent:0,bytes_received:0,registered:[]},api:{bytes_sent:0,bytes_received:0},socket:{bytes_sent:0,bytes_received:0},mux:{bytes_sent:0,bytes_received:0}}},mutations:{ADD_BYTES_SENT:(e,{to:t,bytes:s})=>{e.transfers[t].bytes_sent+=s},ADD_BYTES_RECEIVED:(e,{from:t,bytes:s})=>{e.transfers[t].bytes_received+=s},REGISTER_ASSET:(e,t)=>{e.transfers.assets.registered.push(t)}},getters:{total_bytes_sent:e=>Object.values(e.transfers).map(t=>t.bytes_sent).reduce((t,s)=>t+s),total_bytes_received:e=>Object.values(e.transfers).map(t=>t.bytes_received).reduce((t,s)=>t+s),total_bytes_transferred:(e,t)=>t.total_bytes_sent+t.total_bytes_received,is_registered_asset:e=>t=>e.transfers.assets.registered.find(s=>s.includes(t))},actions:{add_bytes_sent({commit:e},{url:t,to:s,bytes:r}){e("ADD_BYTES_SENT",{to:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),a.info("STORE",`Sent ${r} bytes to ${s}.`)},add_bytes_received({commit:e},{url:t,from:s,bytes:r}){e("ADD_BYTES_RECEIVED",{from:s,bytes:r}),s=="assets"&&e("REGISTER_ASSET",t),a.info("STORE",`Received ${r} bytes from ${s}.`)}}};const k=()=>({meta:null,isMobile:!1,colorPalette:["background","background2","body","highlight","controls","chat"],activeClasses:["active"],users:{},chat:{},announcements:{},uid:localStorage.uid?localStorage.uid:null,blocked:!1,count:0,isAdmin:localStorage.admin?JSON.parse(localStorage.admin):!1});var d=x({strict:!1,state:k(),modules:{livestream:Re,events:ke,network:$e},mutations:{SET_META:(e,t)=>e.meta=t,SET_MOBILE:(e,t)=>e.isMobile=t,setUsers:(e,t)=>e.users=t,setUser:(e,t)=>e.users[t.uid]=t,setChat:(e,t)=>e.chat=t,setMessage:(e,t)=>e.chat[t.time]=t,setAnnouncements:(e,t)=>e.announcements=t,setAnnouncement:(e,t)=>e.announcements[t.time]=t,setUid:(e,t)=>e.uid=t,setBlock:(e,t)=>e.blocked=t,setCount:(e,t)=>e.count=t,setMobile:(e,t)=>e.isMobile=t,adminify:e=>e.isAdmin=!0,RESET:e=>{const t=k();Object.keys(t).forEach(s=>e[s]=t[s])}},getters:{meta:e=>e.meta,isActive:e=>t=>[...e.activeClasses,e.metainfo.buttonWhenStreamIsActive,e.metainfo.buttonWhenStreamIsRewatchable].includes(t),chatArray:e=>Object.values(e.chat),chatByTime:(e,t)=>{let s=[];return e.isMobile?s=[...t.chatArray,...t.publishedAnns].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>{const o=r.publishedAt||r.time,i=n.publishedAt||n.time;return o-i}):s=[...t.chatArray].filter(r=>!r.deleted).filter(r=>r.time>0).sort((r,n)=>r.time-n.time),s},publishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt>0).sort((s,r)=>s.publishedAt-r.publishedAt),unpublishedAnns:(e,t)=>t.announcementsArray.filter(s=>s.time>0).filter(s=>s.publishedAt==0).sort((s,r)=>s.time-r.time),announcementsArray:e=>Object.values(e.announcements).filter(t=>t.deleted===!1)},actions:{fetchMeta({commit:e}){return new Promise((t,s)=>m.meta.get().then(r=>{e("SET_META",r),t(r)}).catch(r=>s(r)))},async getMeta({getters:e,dispatch:t}){return e.meta||await t("fetchMeta")},reset({commit:e}){e("RESET")},registerBroadcasts({state:e,commit:t},s){t("setBroadcasts",s.map(r=>g(l({},r),{theme:e.colorPalette.map(n=>({[`--${n}`]:r[n]})),isInPast:new Date>new Date(r.FilmEndsOn),isInFuture:new Date<new Date(r.LiveStartsOn)})))},socket_user({state:e,commit:t},s){t("setUser",s),e.uid&&s.uid===e.uid&&!e.isAdmin&&(s.blocked?(logger.warn("STORE","blocked"),t("setBlock",!0)):(logger.warn("STORE","unblocked"),t("setBlock",!1)))},socket_userConfirm({commit:e},t){logger.info("STORE","Your User ID:",t),e("setUid",t),localStorage.uid=t},socket_count({commit:e},t){e("setCount",t)},socket_clearchat({commit:e}){e("setChat",{})},socket_clearusers({commit:e}){e("setUsers",{}),localStorage.clear(),window.location.reload(!0)},register({state:e},t){this._vm.$socket.client.emit("user",{name:t,blocked:!1})},deleteMessage(e,t){this._vm.$socket.client.emit("message",g(l({},t),{deleted:!0}))},adminify({commit:e},t){t==="yellow"&&(e("adminify"),localStorage.administrator=!0)}}});const U=j({history:G("/"),routes:[{path:"/",name:"home",component:()=>f(()=>import("./Home.2e36213f.js"),["assets/Home.2e36213f.js","assets/vendor.5c5858dd.js"]),beforeEnter:async()=>await Le()},{path:"/about",name:"about",component:()=>f(()=>import("./About.52ecc1c5.js"),["assets/About.52ecc1c5.js","assets/About.3def71d6.css","assets/vendor.5c5858dd.js"])},{path:"/404",name:"Page Not Found",component:()=>f(()=>import("./404.bf8e743b.js"),["assets/404.bf8e743b.js","assets/vendor.5c5858dd.js"])},{path:"/:slug",name:"event",component:()=>f(()=>import("./Event.ae7edb58.js"),["assets/Event.ae7edb58.js","assets/vendor.5c5858dd.js"]),beforeEnter:async e=>await Oe(e.params.slug)},{path:"/:pathMatch(.*)*",redirect:{name:"Page Not Found"}}]}),Ie=async e=>{try{await d.dispatch("livestream/get_livestream")}catch{return"404"}},Le=async()=>{try{await d.dispatch("events/get_events")}catch{return"404"}},Oe=async e=>{try{await d.dispatch("events/get_event",e)}catch(t){return a.error("ROUTER",`Event page ${e} not found.`,t),"404"}};U.beforeEach(async e=>await Ie());var Ue=(e,t)=>{const s=e.__vccOpts||e;for(const[r,n]of t)s[r]=n;return s};const De={name:"App",setup(){K({base:{href:"/vue-router",target:"_blank"},charset:"utf8",title:"My Title"})},components:{RouterLink:W,RouterView:Y},data(){return{observer:null}},computed:l({},q("network",["total_bytes_sent","total_bytes_received","total_bytes_transferred"])),methods:{format_bytes:R.format_bytes},async created(){R.head_assets()},mounted(){},beforedestroy(){}},Me={class:"wrapper"},Ce=c("h1",null,"The Hmm Livestream",-1),Be=I("Home"),Ve=I("About"),Ne=c("br",null,null,-1),Fe={id:"network"},He=c("td",null,"total bytes sent",-1),xe=c("td",null,"total bytes received",-1),je=c("td",null,"total bytes transferred",-1);function Ge(e,t,s,r,n,o){const i=T("RouterLink"),v=T("RouterView");return z(),J(Z,null,[c("header",null,[c("div",Me,[Ce,c("nav",null,[E(i,{to:"/"},{default:P(()=>[Be]),_:1}),E(i,{to:"/about"},{default:P(()=>[Ve]),_:1})]),Ne,c("table",Fe,[c("tr",null,[He,c("td",null,b(o.format_bytes(e.total_bytes_sent)),1)]),c("tr",null,[xe,c("td",null,b(o.format_bytes(e.total_bytes_received)),1)]),c("tr",null,[je,c("td",null,b(o.format_bytes(e.total_bytes_transferred)),1)])])])]),E(v)],64)}var Ke=Ue(De,[["render",Ge]]);a.intro(p);const D=Q(Ke);X.polyfill();D.config.globalProperties={logger:a,$id:ye};D.use(ee,te(p.socketURL),{store:d}).use(d).use(U).use(se()).mount("#app");export{Ue as _};
